<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Money Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

<!-- Babel -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-gray-100">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

/* ---------- CONFIG ---------- */
const DEFAULT_CATEGORIES = [
  { name:"üçΩÔ∏è Food", budget:3000 },
  { name:"üõçÔ∏è Shopping", budget:2000 },
  { name:"üöá Transportation", budget:1500 },
  { name:"‚õΩ Gasoline", budget:2000 },
  { name:"üì± Phone", budget:800 },
  { name:"üí≥ Charge", budget:5000 },
  { name:"üì¶ Others", budget:1000 }
];

const PAYMENT_METHODS = [
  "üíµ Cash/QR", "üí≥ Credit Card", "‚ô¶Ô∏è TrueMoney", "üê∞ Rabbit Card"
];

/* ---------- HELPERS ---------- */
function getPeriod(dateStr){
  const d = new Date(dateStr);
  const day = d.getDate();
  let m = d.getMonth()+1;
  let y = d.getFullYear();
  if(day < 27){ m--; if(m===0){ m=12; y--; } }
  return `${String(m).padStart(2,"0")}-${y}`;
}

function groupByDate(tx){
  return [...tx]
    .sort((a,b)=>new Date(b.date)-new Date(a.date))
    .reduce((acc,t)=>{
      acc[t.date] = acc[t.date] || [];
      acc[t.date].push(t);
      return acc;
    },{});
}

/* ---------- APP ---------- */
function App(){
  const [view,setView] = useState("list");
  const [categories,setCategories] = useState(DEFAULT_CATEGORIES);
  const [tx,setTx] = useState([]);

  const [form,setForm] = useState({
    date: new Date().toISOString().slice(0,10),
    type: "expense",
    category: DEFAULT_CATEGORIES[0].name,
    method: PAYMENT_METHODS[0],
    amount: 0,
    note: ""
  });

  /* storage */
  useEffect(()=>{
    const d = JSON.parse(localStorage.getItem("money-react")||"{}");
    if(d.tx) setTx(d.tx);
    if(d.categories) setCategories(d.categories);
  },[]);

  useEffect(()=>{
    localStorage.setItem("money-react",JSON.stringify({tx,categories}));
  },[tx,categories]);

  function addTx(){
    if(!form.amount) return;
    setTx([{...form,id:Date.now(),period:getPeriod(form.date)},...tx]);
    setView("list");
    setForm({...form,amount:0,note:""});
  }

  const grouped = groupByDate(tx);

  function categorySpent(name){
    return tx.filter(t=>t.category===name && t.type==="expense")
             .reduce((s,t)=>s+t.amount,0);
  }

  return (
    <div className="max-w-md mx-auto p-4 pb-24">
      {/* HEADER */}
      <div className="flex justify-between mb-4">
        <h1 className="text-xl font-bold">üí∞ Money Tracker</h1>
        {view!=="list" && (
          <button onClick={()=>setView("list")}>‚Üê Back</button>
        )}
      </div>

      {/* LIST VIEW */}
      {view==="list" && (
        <>
          {Object.entries(grouped).map(([date,items])=>(
            <div key={date} className="mb-4">
              <h3 className="text-sm text-gray-500 mb-2">
                {new Date(date).toLocaleDateString("th-TH")}
              </h3>
              {items.map(t=>(
                <div key={t.id}
                  className="bg-white rounded-xl p-3 shadow flex justify-between mb-2">
                  <div>
                    <div className="text-sm">{t.category}</div>
                    <div className="text-xs text-gray-400">{t.method}</div>
                  </div>
                  <div className={t.type==="income"?"text-green-600":"text-red-600"}>
                    {t.type==="income"?"+":"-"}‡∏ø{t.amount}
                  </div>
                </div>
              ))}
            </div>
          ))}

          {/* CATEGORY BUDGET */}
          <div className="mt-6">
            <h2 className="font-semibold mb-2">Category Budgets</h2>
            {categories.map(c=>{
              const spent = categorySpent(c.name);
              const pct = (spent/c.budget)*100;
              return (
                <div key={c.name} className="bg-white p-3 rounded-xl shadow mb-2">
                  <div className="flex justify-between text-sm">
                    <span>{c.name}</span>
                    <span>‡∏ø{spent} / ‡∏ø{c.budget}</span>
                  </div>
                  <div className="bg-gray-200 h-2 rounded mt-1">
                    <div className="bg-indigo-500 h-2 rounded"
                      style={{width:Math.min(pct,100)+"%"}} />
                  </div>
                </div>
              );
            })}
          </div>

          {/* ADD BUTTON */}
          <button
            onClick={()=>setView("add")}
            className="fixed bottom-6 right-6 bg-indigo-600 text-white p-4 rounded-full shadow">
            +
          </button>
        </>
      )}

      {/* ADD VIEW */}
      {view==="add" && (
        <div className="space-y-4">
          <input type="date" className="w-full p-3 rounded border"
            value={form.date}
            onChange={e=>setForm({...form,date:e.target.value})}/>

          <select className="w-full p-3 rounded border"
            value={form.type}
            onChange={e=>setForm({...form,type:e.target.value})}>
            <option value="expense">Outcome</option>
            <option value="income">Income</option>
            <option value="saving">Saving</option>
            <option value="charge">Charge</option>
          </select>

          <div className="grid grid-cols-5 gap-2">
            {categories.map(c=>(
              <button key={c.name}
                onClick={()=>setForm({...form,category:c.name})}
                className={`p-3 rounded-xl border ${
                  form.category===c.name?"bg-indigo-100 border-indigo-500":""
                }`}>
                {c.name.split(" ")[0]}
              </button>
            ))}
          </div>

          <div>
            <label className="text-sm text-gray-500">Amount (THB)</label>
            <input type="number"
              inputMode="decimal"
              step="0.01"
              placeholder="0.00"
              value={form.amount}
              onChange={e=>setForm({...form,amount:Number(e.target.value)})}
              className="w-full text-2xl p-3 rounded-xl border text-right"/>
          </div>

          <input className="w-full p-3 rounded border"
            placeholder="Description"
            value={form.note}
            onChange={e=>setForm({...form,note:e.target.value})}/>

          <button onClick={addTx}
            className="w-full bg-green-500 text-white p-3 rounded-xl">
            Save
          </button>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
